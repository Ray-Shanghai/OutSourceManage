<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>角色信息</title>

<link rel="stylesheet" type="text/css"
	href="../../../resources/jquery-easyui-1.4.3/themes/gray/easyui.css">

<script type="text/javascript"
	src="../../../resources/jquery-easyui-1.4.3/jquery.min.js"></script>
<script type="text/javascript"
	src="../../../resources/jquery-easyui-1.4.3/jquery.easyui.min.js"></script>
<script src="../../../resources/js/base.js"></script>
<script type="text/javascript" src="../../plugins/layui/layui.js"></script>
<link rel="stylesheet" href="../../plugins/layui/css/layui.css"
	media="all">
	<link rel="stylesheet" type="text/css" href="../../css/my.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
	<style type="text/css">
	   
	   .layui-form-radio{
	   		margin:0;
	   }
	
	 </style>
</head>
<body>
	<div class="easyui-layout" fit="true">
	<div data-options="region:'west'" style="width: 800px;heigth:70%;margin-top:20px" title="个人基本信息">
			 <form class="layui-form  ml-30" id="frm1" name="frm1">
				<input type="hidden" value="" name="departId" id="departId"> 
				<input type=hidden value="" name="departName" id="departName"> 
				<input type="hidden" name="functionIds" id="functionIds">
				<div class="layui-form-item">
					<div class="layui-inline">
						<label class="layui-form-label" style ="width:60px">姓名</label>
						<div class="layui-input-inline dx-input-required">
							<input type="text" name="userName" id="userName"  lay-verify="required" autocomplete="off" placeholder="姓名" class="layui-input">
						</div>
					 </div>
					<div class="layui-inline">
						<label class="layui-form-label" style ="width:60px">登录名</label>
						<div class="layui-input-inline dx-input-required">
							<input type="text" name="loginName" id="loginName" lay-verify="required" autocomplete="off" placeholder="登录名" class="layui-input" disabled>
						</div>
					</div>
					
				</div>
				<div class="layui-form-item">
					<div class="layui-inline">
						<label class="layui-form-label" style ="width:60px">手机</label>
						<div class="layui-input-inline dx-input-required">
							<input type="text" name="phone" lay-verify="required"
								autocomplete="off" placeholder="手机" class="layui-input">
						</div>
				</div>
				 	<div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">邮箱</label>
					<div class="layui-input-inline dx-input-required">
						<input type="text" name="email" lay-verify="required"
							autocomplete="off" placeholder="邮箱" class="layui-input">
					</div>
				 </div>
				
			</div>
			<!-- <div class="layui-form-item">
			
				<div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">QQ</label>
					<div class="layui-input-inline dx-input-required">
						<input type="text" name="qq" lay-verify="required"
							autocomplete="off" placeholder="QQ" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
						<label class="layui-form-label" style ="width:60px">生日</label>
						<div class="layui-input-inline dx-input-required">
							<input type="text" name="brithday" lay-verify="required"
								autocomplete="off" placeholder="生日" class="layui-input">
						</div>
				</div>
			</div>	  -->
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">性别</label>
				    <div class="layui-input-inline" >
				      <input type="radio" name="sex" value="男" title="男" >
				      <input type="radio" name="sex" value="女" title="女">
 				    </div>
				 </div>
				 
				 <div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">状态</label>
				    <div class="layui-input-inline" >
      					<input type="radio" name="status" value="Y" title="正常" >
				        <input type="radio" name="status" value="N" title="禁用">
 				    </div>
				 </div>
				
			</div>	
				<div class="layui-form-item">
				 
				<div class="layui-inline">
						<label class="layui-form-label" style ="width:60px">生日</label>
						<div class="layui-input-inline dx-input-required">
							<input type="date" name="brithday" lay-verify="required"
								autocomplete="off" placeholder="生日" class="layui-input">
						</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">微信绑定</label>
					 <div class="layui-input-inline" >
					 	<input type="hidden" name="wxOpenId" >
      					<input type="radio" name="wxStatus" value="Y" title="已绑定" >
				        <input type="radio" name="wxStatus" value="N" title="未绑定">
 				    </div>
				 </div>
				 <!-- <div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">登录密码</label>
					<div class="layui-input-inline dx-input-required">
						<input type="password" name="loginPwd" id="loginPwd" lay-verify="required"
							autocomplete="off" placeholder="登录密码" class="layui-input" disabled>
					</div>
				 </div> -->
			</div>	
			<div class="layui-form-item">
				 
				<!-- <div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">部门</label>
					<div class="layui-input-inline dx-input-required">
						  <div class="layui-input-inline" id="departName1" >
				       
 				    </div>
					</div>
				 </div> -->
				 <div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">提成比例</label>
					<div class="layui-input-inline dx-input-required">
						<select name="accountType" id="accountType">
							<option value="">请选择职位</option>
						</select>
					</div>
				 </div>
				 <div class="layui-inline">
					<label class="layui-form-label" style ="width:60px">职位</label>
					<div class="layui-input-inline dx-input-required">
						<select name="position" id="position">
							<option value="">请选择职位</option>
							<option value="0">外协经理</option>
							<option value="1">核价经理</option>
							<option value="2">采购经理</option>
							<option value="3">检验经理</option>
							<option value="4">采购员</option>
							<option value="5">检验员</option>
						</select>
					</div>
				 </div>
			</div>	
			<!-- <div class="layui-form-item">
				 <div class="layui-inline">
					 
				    <div class="layui-input-inline" >
				      <font color="red"> （ 请选择右边对应的组织架构进行操作）</font>
 				    </div>
				 </div>
			</div>	 -->
			
	 
			
			 
			</form>
		</div>
		<!-- <div data-options="region:'center'"   style="width: 200px;heigth:70%" title ="部门">
			<ul id="sysdepartInfoId" class="easyui-tree"  ></ul>
		</div> -->
		<div data-options="region:'east',iconCls:'icon-ok' "  style="width: 200px;heigth:70%"  title ="角色">
			<ul id="sysdepartInfoRoleId" class="easyui-tree"   ></ul>
		</div>
	</div>
	<script type="text/javascript">
		layui.config({
			base : '../../js/'
		});
		layui.use([ 'paging', 'form', 'element' ], function() {
			var $ = layui.jquery, element = layui.element(); //Tab的切换功能，切换事件监听等，需要依赖element模块
			paging = layui.paging(),
					layerTips = parent.layer === undefined ? layui.layer
							: parent.layer, //获取父窗口的layer对象
					layer = layui.layer, //获取当前窗口的layer对象
					form = layui.form();
 
					$.ajax({type : 'POST',
						url : base.serverContent+ '/manager/loginIn/SysUserInfo/queryByPkId.do?userId='+window.location.search.split("?")[1],
						async : false,
						success : function(data) {
								for(var key in data.sysUserInfo){
									var val=data.sysUserInfo[key];
									if(key=="position"){
										$("#position").val(val);
 									}
									if(key=="departName"){
										$("#departName1").text(val);
										$("#departName").val( val.split("-")[val.split("-").length-1]);
										
									}else if(key=="status"||key=="sex"){
										 $("input[name='"+key+"'][value="+val+"]").attr("checked",true)
										 
										
									}else if(key=="wxOpenId"){
										if(val!=null&&val!=""&&val!=undefined){
											 $("input[name='wxStatus'][value='Y']").attr("checked",true);
										}else{
											$("input[name='wxStatus'][value='N']").attr("checked",true);
										}
									}else{
										$("input[name="+key+"]").val(val);
									}
								}
								
								$.ajax({
									type : 'GET',
									url: base.serverContet+'/SdPushSetInfo/queryList.do', //地址
									//同步  
									async : false,
									success : function(result) {
										 $("#accountType").html("");
								            if (result.code==0) {
								            	 $("#accountType").append("<option value=''>请选择提成比列</option>")
								           	 for(var i=0;i<result.rows.length;i++){
								           		 if(data.sysUserInfo.accountType==result.rows[i].pushSetId){
								           			$("#accountType").append(new Option(result.rows[i].pushSetName+"("+result.rows[i].pushNum+"%)",result.rows[i].pushSetId,true,true));
								           		 }else{
								           		 	$("#accountType").append(new Option(result.rows[i].pushSetName+"("+result.rows[i].pushNum+"%)",result.rows[i].pushSetId));
								           		 }
								           	}
								           }
									},
									error : function() {
									}
									
								});
								
								form.render();
						},error : function() {
						}
						});
					
					
					/* $('#sysdepartInfoId').tree({
						url : '../../../manager/loginIn/SysDepartInfo/queryList.do?notNodeType=5&isShowLastNoChild=N',
						method : 'get',
						animate : true,
						checkbox : false
					}); */
					
					$('#sysdepartInfoRoleId').tree({
						url : '../../../manager/loginIn/SysDepartInfo/queryList.do?isShowLastNoChild=N&dataType=5&userId='+window.location.search.split("?")[1],
						method : 'get',
						animate : true,
						checkbox : true
					});
					
					
					
					
		});

		
		
		
		/* $('#sysdepartInfoId').tree({
		    onClick: function(node){
		    //	
		    if(node.id.length==3||node.id.length==9||node.id.length==15||node.id.length==21){
				$
				.ajax({
					type : 'GET',
					url: base.serverContet+'/manager/loginIn/SysDepartInfo/getDepartInfoByDepartId.do?departId='+ node.id, //地址
					//同步  
					async : false,
					success : function(data) {
						$("#departName1").html(data.sysDepartInfo.departName);
						$("#departId").val(data.sysDepartInfo.departId);
						$("#departName").val( data.sysDepartInfo.departName.split("-")[data.sysDepartInfo.departName.split("-").length-1]);
						 
					},
					error : function() {
					}
				});
		    }
		    }
		}); */
		
		
		
		
		var getRoles =function(){
			
			if($("#userName").val()==""){
				alert('姓名不能为空');
				return false;
			}
			if($("#loginName").val()==""){
				alert('登录名不能为空');
				return false;
			}
			/* if($("#loginPwd").val()==""){
				alert('登录密码不能为空');
				return false;
			} */
			if($("#position").val()==""){
				alert('职位不能为空');
				return false;
			}
			var nodes = $('#sysdepartInfoRoleId').tree(
			'getChecked');
			var s = '';
			for (var i = 0; i < nodes.length; i++) {
				if (s != '') {
					s += ',';
				}
				var nodeId = nodes[i].id;
				if (nodeId.length == 9||nodeId.length == 15||nodeId.length == 21||nodeId.length == 27) {
					var tt=	nodeId.substring(0,nodeId.length-3).substring(nodeId.length-6);
					if(tt=="002"){
						console.info(s);
						s += nodeId;
					}
				}
			}
			if (s.trim() == "") {
				alert('请选择角色。');
				return false;
		
			}
			
			$("#functionIds").val("," + s + ",");
			
			return true;
			 
		}
		
		
	 
	</script>
</body>
</html>